---
title: "ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç”¨ã®é«˜é€Ÿãªå…¥åŠ›ãƒã‚¯ãƒ­(Rust)"
emoji: "ğŸˆ"
type: "tech" 
topics: ["Rust","ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°","ãƒã‚¯ãƒ­","ç«¶ãƒ—ãƒ­","æ¨™æº–å…¥åŠ›"]
published: true
---
é«˜é€Ÿã¨ã‹è¨€ã£ã¦ã”ã‚ã‚“ãªã•ã„é…ã„ã§ã™
2021/03/27 è¿½è¨˜ æ—©ããªã‚Šã¾ã—ãŸ

## ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

Rust ã§ã¯ C++ ã®æ§˜ã«ç°¡ç´ ãªæ¨™æº–å…¥åŠ›ã‚’å—ã‘å–ã‚‹ä»•çµ„ã¿ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãã®ãŸã‚ AtCoder ã§ã¯ é…æ…®ã•ã‚ŒãŸã®ã‹æ¨™æº–å…¥åŠ›ã‚’ç°¡æ½”ã«è¨˜è¼‰ã™ã‚‹ crate ãŒä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ç§ã®è¦³æ¸¬ç¯„å›²ã§ã¯ç‰¹ã«ç†ç”±ãŒãªã‘ã‚Œã° [proconio](https://crates.io/crates/proconio) ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

ãã“ã§ ã€ŒAtCoder ã§ Rust ã‚’ä½¿ç”¨ã—ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å§‹ã‚ãŸãŒã€codeforces ç­‰ã®ä»–ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã«å‡ºå ´ã™ã‚‹éš›ã«æ¨™æº–å…¥åŠ›ãŒãƒãƒ¼ãƒ‰ãƒ«ã§å‚åŠ ã—ã¦ã„ãªã„ã€‚ã€ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãŒå‡ºç¾ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚(ç§ã§ã™)
â€»codeforces ã§ã¯å¤–éƒ¨ crate ã¯ä½¿ç”¨ã§ããªã„

## æ–¹é‡

ã¨ã„ã†ã“ã¨ã§æ±ºã¾ã£ãŸæ–¹é‡ã¯ä»¥ä¸‹

- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯proconio è¸è¥²
- éæ¨™æº–crateä¸ä½¿ç”¨
- ã§ãã‚‹ã ã‘é«˜é€Ÿ
- ~~è¡Œæ•°ã¯å°‘ãªã(é‡è¦)~~

## å®Ÿè£…

```rust:io_pro
#[macro_export]
macro_rules! input{
    (sc=$sc:expr,$($r:tt)*)=>{
        input_inner!{$sc,$($r)*}
    };
    ($($r:tt)*)=>{
        let mut sc=fast_input::Scanner::new(std::io::stdin().lock(),4096);
        input_inner!{sc,$($r)*}
    };
}

#[macro_export]
macro_rules! input_inner{
    ($sc:expr)=>{};
    ($sc:expr,)=>{};
    ($sc:expr,$var:ident:$t:tt$($r:tt)*)=>{
        let $var=read_value!($sc,$t);
        input_inner!{$sc $($r)*}
    };
}

#[macro_export]
macro_rules! read_value{
    ($sc:expr,($($t:tt),*))=>{
        ($(read_value!($sc,$t)),*)
    };
    ($sc:expr,[$t:tt;$len:expr])=>{
        (0..$len).map(|_|read_value!($sc,$t)).collect::<Vec<_>>()
    };
    ($sc:expr,Chars)=>{read_value!($sc,String).chars().collect::<Vec<char>>()};
    ($sc:expr,Usize1)=>{read_value!($sc,usize)-1};
    ($sc:expr,$t:ty)=>{$sc.next::<$t>()};
}
pub struct Scanner {
    buf: Vec<u8>,
    pos: usize,
}
impl Scanner {
    pub fn new<R: std::io::Read>(mut reader: R, estimated: usize) -> Self {
        let mut buf = Vec::with_capacity(estimated);
        let _ = std::io::copy(&mut reader, &mut buf).unwrap();
        if buf.last() != Some(&b'\n') {
            panic!("{}", 0);
        }
        Scanner { buf, pos: 0 }
    }
    #[inline]
    pub fn next<T: std::str::FromStr>(&mut self) -> T
    where
        T::Err: std::fmt::Debug,
    {
        let mut start = None;
        loop {
            match (self.buf[self.pos], start.is_some()) {
                (b' ', true) | (b'\n', true) => break,
                (_, true) | (b' ', false) | (b'\n', false) | (b'\r', false) => self.pos += 1,
                (_, false) => start = Some(self.pos),
            }
        }
        let target = &self.buf[start.unwrap()..self.pos];
        unsafe { std::str::from_utf8_unchecked(target) }
            .parse()
            .unwrap()
    }
}

```

å‰åŠã®ãƒã‚¯ãƒ­éƒ¨åˆ†ã®~~ãƒ‘ã‚¯ãƒª~~å…ƒ

https://qiita.com/tanakh/items/0ba42c7ca36cd29d0ac8

proconio ã®å…ƒã¨ãªã£ãŸ(?) @tanakh ã•ã‚“ã®ãƒã‚¯ãƒ­ ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹éƒ¨åˆ†ã‚’ä½¿ã‚ã›ã¦ã„ãŸã ã„ã¦ã„ã¾ã™ã€‚
å¤‰æ›´ç‚¹

- source ã‚’å‰Šé™¤
- å…¥åŠ›ã®å—ã‘å–ã‚Šæ–¹æ³•ã‚’å¤‰æ›´

å¾ŒåŠéƒ¨åˆ†ã®æ§‹é€ ä½“ã®~~ãƒ‘ã‚¯ãƒª~~å…ƒ
https://qiita.com/tatsuya6502/items/cd448486f7ef7b5b8c7e
ã“ã®è¨˜äº‹ã« @qryxip ã•ã‚“ãŒã‚³ãƒ¡ãƒ³ãƒˆã§æ›¸ã‹ã‚Œã¦ã„ãŸ InputScanOnce ã‚’æµç”¨ã•ã›ã¦ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚

å¤‰æ›´ç‚¹

- codeforces ã«åˆã‚ã›ã¦æ”¹è¡ŒåŒºåˆ‡ã‚Šã« "\r" ã‚’è¿½åŠ 

https://qiita.com/tatsuya6502/items/cd448486f7ef7b5b8c7e

### ä¸­èº«ã«ã¤ã„ã¦

String::split_whitespace ã§åˆ†å‰²ã™ã‚‹æ–¹å¼ã§ã¯ãªãã€ä¸€æ–‡å­—ã¥ã¤å‡¦ç†ã™ã‚‹æ–¹å¼ã‚’é¸æŠã—ã¾ã—ãŸã€‚ç†ç”±ã¨ã—ã¦ã¯ codeforces ã§ã‚ˆãã‚ã‚‹ãƒãƒ«ãƒãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ ã«å¯¾å¿œã—è¾›ã‹ã£ãŸã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

ãƒãƒ«ãƒãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä¾‹

```text
3           // ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°
2           // n
1 0         // é•·ã• n ã®é…åˆ—
3
3 2 1
5
10 9 8 7 6 
```

```rust:proconio
input!(t: usize);
for _ in 0..t {
    input!(n: usize, a: [i64; n]);
    // å‡¦ç†
}
```

```rust:io_pro
let mut sc = io_pro::Scanner::new(std::io::stdin().lock(), 4096);

input!(sc = sc, t: usize);
for _ in 0..t {
    input!(sc = sc, n: usize, a: [i64; n]);
    // å‡¦ç†
}
```

proconio ãŒè£ã§æŒã£ã¦ã„ã‚‹å…¥åŠ›ã®ãƒ­ãƒƒã‚¯ã‚’æ‰‹å‹•ã§æŒã¡å›ã£ã¦ã„ã¾ã™ã€‚input! ãƒã‚¯ãƒ­ã‚’ä¸€åº¦ã—ã‹ä½¿ç”¨ã—ãªã„å ´åˆã¯ã€ Scanner æ§‹é€ ä½“ã¯ãƒã‚¯ãƒ­å´ã§ç”Ÿæˆã™ã‚‹ã®ã§ proconio ã¨åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§åˆ©ç”¨ã§ãã¾ã™ã€‚

## è¨ˆæ¸¬

è¨ˆæ¸¬æ‰‹æ³•ã¯[å…ˆç¨‹ã®è¨˜äº‹](https://qiita.com/tatsuya6502/items/cd448486f7ef7b5b8c7e)ã‚’è¸è¥²ã—ã€1e7è¡Œã®å…¥åŠ›ã‚’èª­ã¿è¾¼ã¿å¹³å‡ã‚’å–ã‚Šã¾ã™ã€‚
ä»Šå›ã¯ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã‚ˆãã‚ã‚‹å¤§ããªå…¥åŠ›ã¨ã„ã†ã“ã¨ã§ã€1e5ã‚‚è¨ˆæ¸¬ã—ã¦ã„ã¾ã™ã€‚
ã‚½ãƒ¼ã‚¹ ã¯[ã“ã¡ã‚‰](
https://github.com/uesugi6111/io_pro)
ç’°å¢ƒ
Windows WSL2
1.50.0-x86_64-unknown-linux-gnu
core i5 9400F
çµæœ

|        |  1e5  |    1e7   |
|  ----  | ----  |   ----   |
|proconio|  40ms   |  2315.6ms  |
| io_pro |  66ms   |  5492.4ms  |

é…ã„ã§ã™ã­ã€‚å®Œã€‚

## ã¾ã¨ã‚

ãªã‚“ã¨ã‹ä¼¼ãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§å‹•ãã‚‚ã®ã«ãªã£ãŸã®ã§ã™ãŒã€é…ã„éƒ¨åˆ†ã§ã‚ã£ãŸã‚Šã€æ§‹é€ ä½“ã®ä½¿ã„å›ã—ã®è¨˜è¿°ã§ã‚ã£ãŸã‚Šã€å…¥åŠ›å¾Œctrl + Dã—ãªã„ã¨å‹•ã„ã¦ãã‚Œãªã‹ã£ãŸã‚Š ã§æ°—ã«å…¥ã£ã¦ãªã„éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚
è¨˜äº‹ã‚’æ›¸ã„ãŸç†ç”±ã®å¤§ãã„éƒ¨åˆ†ã¨ã—ã¦ã€Œæœ‰è­˜è€…ãŒãªã«ã‹æ•™ãˆã¦ãã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã€ã¨ã„ã†ã®ãŒã‚ã‚‹ã®ã§ã€ä½•ã‹ãŠæ°—ã¥ãã®æ–¹ã¯æ•™ãˆã¦ä¸‹ã•ã„ã€‚
ãŠé¡˜ã„ã—ã¾ã™ã€‚

## è¿½è¨˜ 2021/03/27

ãƒ‘ãƒ¼ã‚¹ã™ã‚‹éƒ¨åˆ†ã¯ãƒãƒƒã‚¯ãªã®ã§ã¯ï¼Ÿ ã¨ã®æŒ‡æ‘˜ã‚’ ã•ã‚“ã«ã„ãŸã ãæ›¸ãæ›ãˆã€‚

```rust:io_pro
#[macro_export]
macro_rules! input{
    (sc=$sc:expr,$($r:tt)*)=>{
        input_inner!{$sc,$($r)*}
    };
    ($($r:tt)*)=>{
        let mut sc=io_pro::Scanner::new(std::io::stdin().lock());
        input_inner!{sc,$($r)*}
    };
}

#[macro_export]
macro_rules! input_inner{
    ($sc:expr)=>{};
    ($sc:expr,)=>{};
    ($sc:expr,$var:ident:$t:tt$($r:tt)*)=>{
        let $var=read_value!($sc,$t);
        input_inner!{$sc $($r)*}
    };
}

#[macro_export]
macro_rules! read_value{
    ($sc:expr,($($t:tt),*))=>{
        ($(read_value!($sc,$t)),*)
    };
    ($sc:expr,[$t:tt;$len:expr])=>{
        (0..$len).map(|_|read_value!($sc,$t)).collect::<Vec<_>>()
    };
    ($sc:expr,Chars)=>{read_value!($sc,String).chars().collect::<Vec<char>>()};
    ($sc:expr,Usize1)=>{read_value!($sc,usize)-1};
    ($sc:expr,$t:ty)=>{$sc.next::<$t>()};
}
pub struct Scanner {
    s: Box<str>,
    input: std::iter::Peekable<std::str::SplitAsciiWhitespace<'static>>,
}
impl Scanner {
    pub fn new<R: std::io::Read>(mut reader: R) -> Self {
        let s = {
            let mut s = String::new();
            reader.read_to_string(&mut s).unwrap();
            s.into_boxed_str()
        };
        let mut sc = Scanner {
            s,
            input: "".split_ascii_whitespace().peekable(),
        };
        use std::mem;
        let s: &'static str = unsafe { mem::transmute(&*sc.s) };
        sc.input = s.split_ascii_whitespace().peekable();
        sc
    }
    #[inline]
    pub fn next<T: std::str::FromStr>(&mut self) -> T
    where
        T::Err: std::fmt::Debug,
    {
        self.input
            .next()
            .unwrap()
            .parse::<T>()
            .expect("Parse error")
    }
}
```

åˆæœŸåŒ–ã®éš›ã«æ¨™æº–å…¥åŠ›ã‚’èª­ã¿åˆ‡ã‚Šã€èª­ã¿å–ã£ãŸå€¤ã‚’ãƒ‘ãƒ¼ã‚¹ã›ãš Scanner ã«ä¿æŒã™ã‚‹æ–¹å¼ã§ã™ã€‚
æœ€çµ‚çš„ã«proconio ã«è¿‘ããªã‚Šã¾ã—ãŸã­ã€‚~~ã¨ã„ã†ã‹ä¸€ç·’ã§ã¯~~

ã‚‚ã†ä¸€åº¦è¨ˆæ¸¬

|         |  1e5  |    1e7   |
|  ----   | ----  |   ----   |
|proconio |  40ms   |  2315.6ms  |
| io_pro  |  66ms   |  5492.4ms  |
|  è¿½è¨˜   |  35.2ms   |  1839.4ms  |
æ—©ããªã£ã¦ã„ã¾ã™ã­ã€‚

å…ƒã€…ä¸€æ–‡å­—ãšã¤èª­ã¿å–ã‚‹æ–¹å¼ã«ã—ãŸç†ç”±ã¨ã—ã¦[ã“ã®](https://qiita.com/tatsuya6502/items/cd448486f7ef7b5b8c7e)è¨˜äº‹ã§ã®é€Ÿåº¦æ¯”è¼ƒã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã—ãŸã€‚ç§ã®ç¾åœ¨ã®ç’°å¢ƒã§ã¯è¨˜äº‹ã¨ã¯ç•°ãªã£ãŸçµæœãŒå‡ºã¦ã„ãã†ã§ã™ãŒã€ç’°å¢ƒã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å‡¦ç†ç­‰ã®ã©ã®è¦å› ãŒå½±éŸ¿ã—ã¦ã„ã‚‹ã‹ã¾ã§ã¯è¨ˆæ¸¬èª¿æŸ»ä¸­ã¨ãªã‚Šã¾ã™ã€‚
